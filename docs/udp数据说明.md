# UDP数据传输说明

### UDP端口

- 向dll发送数据的目标端口为`12307`，发送成功之后dll端会返回数据
- dll事件上报的目标端口为`12306`，不需要

### 数据编码格式
- 字节流（字节数组）
- 16进制，即2位表示一个字节

----------------------------

## 向dll发送数据

### 数据发送格式
- 前8字节（16位）为操作码，将10进制操作码转换为16进制（**小端字节序**）得到，空位以0填充
- 示例代码（C#）
	```csharp
	BitConverter.GetBytes((byte)cmdType)
	```
- 其余字节为操作码的参数，参数为`int`类型时，将参数转换为16进制（**小端字节序**）；参数为字符串时，使用UTF-8字节流编码字符串
- 参数部分最少为8字节，空位以0填充
- 操作码及参数详见[操作码对照](#CmdTypeTable)
- 将操作码和参数转换成对应的数据之后进行拼接即可得到要发送的数据
- 例如，操作码为`53`，将其转换为16进制（**小端字节序**）并以0填充空位得到`3500000000000000`，参数为`"cmd test"`，将其使用UTF-8编码得到字节流`636D642074657374`，则得到要发送的UDP报文为：
	> 3500000000000000636D642074657374

### 数据的接收
- 数据大小固定为16字节
- 当向dll发送数据之后，会得到一个返回值，类似于http请求
- 前8字节为使用的操作码，9-16字节为返回结果（均为int类型）
- 返回结果解码需要先除去空字节，然后使用**小端字节序**解码成十进制

----------------------------

## dll事件上报

### 接收数据格式
- 报文大小固定为10240字节
- 前32字节为事件类型，参照[消息上报类型对照](#EventTypeTable)，以UTF-8解码后去除空位得到
- 第33-64字节为触发事件的主体（EAID），以UTF-8解码后去除空位得到
- 其余字节为事件内容

### 事件内容详解

- `onChatMessage` 
	- 事件主体不包含战排名称
	- 事件内容以UTF-8解码即可得到消息内容

- `onKillLog`
	- 事件主体和被击杀者均包含战排名称
	- 将事件内容以UTF-8解码可以得到`{被击杀者}#{武器名称}#0`

----------------------------

<a id="CmdTypeTable"></a>
### 操作码对照表
| 操作码 | 数据类型  | 参数                      |  参数数据类型  | 说明                         |
|-------|-----------|--------------------------|---------------|------------------------------|
| 48    | int64     | 玩家ID                    | `string`      |  屏蔽玩家ID                  |
| 49    | int64     | 玩家ID                    | `string`      | 取消屏蔽玩家ID                |
| 51    | int64     | 服务器ID                  | `int64`       | 离开服务器ID对应的服务器       |
| 52    | int64     | `0`                       | `int64`       | 获取当前服务器的ID            |
| 50    | int64     | 服务器ID                  | `int64`       | 加入服务器ID对应的服务器       |
| 53    | int64     |  消息内容                 | `string`      | 在当前服务器中发送消息         |
| 54    | int64     |  EAID                    | `string`      |  获取当然服务器中EAID对应的PID |
| 55    | int64     | `1`                      | `int64`         | 获取当前Session               |
| 56    | int64     | {游戏名称}+"[split]"+{游戏描述} | `string` | 设置创建游戏时描述和名称       |


<a id="EventTypeTable"></a>
### 消息上报类型对照表

| 消息类型         | 数据类型 | 说明         | UTF-8字节流编码            |
|:----------------|:---------|:------------|:---------------------------|
| `onChatMessage` | string   | 聊天信息上报 | 6f6e436861744d657373616765 |
| `onKillLog`     | string   | 击杀信息上报 | 6f6e4b696c6c4c6f67         |
